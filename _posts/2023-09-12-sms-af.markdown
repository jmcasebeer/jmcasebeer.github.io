---
layout: page
title: Supervised Multi-Step AFs
permalink: /metaaf/sms-af
description: Scaling Up Adaptive Filter Optimizers
date: 2023-09-12
---
# Overview
We introduce a new online adaptive filtering method called supervised multi-step adaptive filters (SMS-AF). Our method uses neural networks to control or optimize linear multi-delay or multi-channel frequency-domain filters and can flexibly scale-up performance at the cost of increased compute -- a property rarely addressed in the AF literature, but critical for many applications. To do so, we extend recent work with a series of improvements including feature pruning, a supervised loss, and multiple optimization steps per time-frame. These improvements work together in a cohesive manner to unlock scaling. Furthermore, we show how our method relates to Kalman filtering and meta-adaptive filtering, making it seamlessly applicable to a diverse set of AF tasks. We evaluate our method on acoustic echo cancellation (AEC) and multi-channel speech enhancement tasks and compare against several baselines on standard synthetic and real-world datasets. Results show our method performance scales with inference cost and model capacity, yields multi-dB performance gains for both tasks, and is real-time capable on a single CPU core.

---

We have released code and will release model checkpoints using the `metaaf` python package developed for this work. For demos of the code, setup instructions, and more, check out the [GitHub repo](https://github.com/adobe-research/MetaAF/tree/ct-meta-af). To listen to model outputs, keep scrolling.

---

We release model inputs and outputs for both the acoustic echo cancellation (AEC) and generalized sidelobe canceller (GSC) experiments.

**AEC Demo Files**
<table border="1" style="margin:1px auto; width:100%">
<tr>
<td>Near-end</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_10_d.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_50_d.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_275_d.mp3" /></audio></td>
</tr>
<tr>
<td>Near-end Speech</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_10_s.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_50_s.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_275_s.mp3" /></audio></td>
</tr>
<tr>
<td>NLMS</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_10_out_nlms.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_50_out_nlms.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_275_out_nlms.mp3" /></audio></td>
</tr>
<tr>
<td>KF</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_10_out_kf_15.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_50_out_kf_15.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_275_out_kf_15.mp3" /></audio></td>
</tr>
<tr>
<td>NKF</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_10_out_nkf.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_50_out_nkf.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_275_out_nkf.mp3" /></audio></td>
</tr>
<tr>
<td>Diag. Meta-AF</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_10_out_uef_self_32h_ola_noaw_prior_diag.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_50_out_uef_self_32h_ola_noaw_prior_diag.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_275_out_uef_self_32h_ola_noaw_prior_diag.mp3" /></audio></td>
</tr>
<tr>
<td>S-U-P</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_10_out_uef_self_16h_ola_noaw_prior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_50_out_uef_self_16h_ola_noaw_prior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_275_out_uef_self_16h_ola_noaw_prior.mp3" /></audio></td>
</tr>
<tr>
<td>M-U-P</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_10_out_uef_self_32h_ola_noaw_prior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_50_out_uef_self_32h_ola_noaw_prior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_275_out_uef_self_32h_ola_noaw_prior.mp3" /></audio></td>
</tr>
<tr>
<td>L-U-P</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_10_out_uef_self_64h_ola_noaw_prior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_50_out_uef_self_64h_ola_noaw_prior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_275_out_uef_self_64h_ola_noaw_prior.mp3" /></audio></td>
</tr>
<tr>
<td>S-S-P</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_10_out_uef_echo_16h_ola_noaw_prior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_50_out_uef_echo_16h_ola_noaw_prior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_275_out_uef_echo_16h_ola_noaw_prior.mp3" /></audio></td>
</tr>
<tr>
<td>M-S-P</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_10_out_uef_echo_32h_ola_noaw_prior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_50_out_uef_echo_32h_ola_noaw_prior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_275_out_uef_echo_32h_ola_noaw_prior.mp3" /></audio></td>
</tr>
<tr>
<td>L-S-P</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_10_out_uef_echo_64h_ola_noaw_prior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_50_out_uef_echo_64h_ola_noaw_prior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_275_out_uef_echo_64h_ola_noaw_prior.mp3" /></audio></td>
</tr>
<tr>
<td>S-S-PU</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_10_out_uef_echo_16h_ola_noaw_posterior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_50_out_uef_echo_16h_ola_noaw_posterior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_275_out_uef_echo_16h_ola_noaw_posterior.mp3" /></audio></td>
</tr>
<tr>
<td>M-S-PU</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_10_out_uef_echo_32h_ola_noaw_posterior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_50_out_uef_echo_32h_ola_noaw_posterior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_275_out_uef_echo_32h_ola_noaw_posterior.mp3" /></audio></td>
</tr>
<tr>
<td>L-S-PU</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_10_out_uef_echo_64h_ola_noaw_posterior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_50_out_uef_echo_64h_ola_noaw_posterior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_275_out_uef_echo_64h_ola_noaw_posterior.mp3" /></audio></td>
</tr>
<tr>
<td>S-S-PUx2</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_10_out_uef_echo_16h_ola_noaw_2posterior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_50_out_uef_echo_16h_ola_noaw_2posterior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_275_out_uef_echo_16h_ola_noaw_2posterior.mp3" /></audio></td>
</tr>
<tr>
<td>M-S-PUx2</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_10_out_uef_echo_32h_ola_noaw_2posterior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_50_out_uef_echo_32h_ola_noaw_2posterior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_275_out_uef_echo_32h_ola_noaw_2posterior.mp3" /></audio></td>
</tr>
<tr>
<td>L-S-PUx2</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_10_out_uef_echo_64h_ola_noaw_2posterior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_50_out_uef_echo_64h_ola_noaw_2posterior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/aec_275_out_uef_echo_64h_ola_noaw_2posterior.mp3" /></audio></td>
</tr>
</table>

**VOLUME WARNING -- THESE FILES ARE LOUD**

**GSC Demo Files**
<table border="1" style="margin:1px auto; width:100%">
<tr>
<td>Mixture</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_1_m.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_278_m.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_519_m.mp3" /></audio></td>
</tr>
<tr>
<td>Clean Speech</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_1_s.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_278_s.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_519_s.mp3" /></audio></td>
</tr>
<tr>
<td>NLMS</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_1_out_gsc_nlms.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_278_out_gsc_nlms.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_519_out_gsc_nlms.mp3" /></audio></td>
</tr>
<tr>
<td>RLS</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_1_out_gsc_rls.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_278_out_gsc_rls.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_519_out_gsc_rls.mp3" /></audio></td>
</tr>
<tr>
<td>S-U-P</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_1_out_gsc_self_16.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_278_out_gsc_self_16.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_519_out_gsc_self_16.mp3" /></audio></td>
</tr>
<tr>
<td>M-U-P</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_1_out_gsc_self.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_278_out_gsc_self.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_519_out_gsc_self.mp3" /></audio></td>
</tr>
<tr>
<td>L-U-P</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_1_out_gsc_self_64.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_278_out_gsc_self_64.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_519_out_gsc_self_64.mp3" /></audio></td>
</tr>
<tr>
<td>S-S-P</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_1_out_gsc_sisdr_val_sisdr_16.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_278_out_gsc_sisdr_val_sisdr_16.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_519_out_gsc_sisdr_val_sisdr_16.mp3" /></audio></td>
</tr>
<tr>
<td>M-S-P</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_1_out_gsc_sisdr_val_sisdr.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_278_out_gsc_sisdr_val_sisdr.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_519_out_gsc_sisdr_val_sisdr.mp3" /></audio></td>
</tr>
<tr>
<td>L-S-P</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_1_out_gsc_sisdr_val_sisdr_64.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_278_out_gsc_sisdr_val_sisdr_64.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_519_out_gsc_sisdr_val_sisdr_64.mp3" /></audio></td>
</tr>
<tr>
<td>S-S-PU</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_1_out_gsc_sisdr_val_sisdr_posterior_16.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_278_out_gsc_sisdr_val_sisdr_posterior_16.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_519_out_gsc_sisdr_val_sisdr_posterior_16.mp3" /></audio></td>
</tr>
<tr>
<td>M-S-PU</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_1_out_gsc_sisdr_val_sisdr_posterior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_278_out_gsc_sisdr_val_sisdr_posterior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_519_out_gsc_sisdr_val_sisdr_posterior.mp3" /></audio></td>
</tr>
<tr>
<td>L-S-PU</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_1_out_gsc_sisdr_val_sisdr_posterior_64.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_278_out_gsc_sisdr_val_sisdr_posterior_64.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_519_out_gsc_sisdr_val_sisdr_posterior_64.mp3" /></audio></td>
</tr>
<tr>
<td>S-S-PUx2</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_1_out_gsc_sisdr_val_sisdr_2iter_posterior_16.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_278_out_gsc_sisdr_val_sisdr_2iter_posterior_16.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_519_out_gsc_sisdr_val_sisdr_2iter_posterior_16.mp3" /></audio></td>
</tr>
<tr>
<td>M-S-PUx2</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_1_out_gsc_sisdr_val_sisdr_2iter_posterior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_278_out_gsc_sisdr_val_sisdr_2iter_posterior.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_519_out_gsc_sisdr_val_sisdr_2iter_posterior.mp3" /></audio></td>
</tr>
<tr>
<td>L-S-PUx2</td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_1_out_gsc_sisdr_val_sisdr_2iter_posterior_64.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_278_out_gsc_sisdr_val_sisdr_2iter_posterior_64.mp3" /></audio></td>
<td><audio controls style="width: 150px;"><source src="/assets/audio/sms-af/gsc_519_out_gsc_sisdr_val_sisdr_2iter_posterior_64.mp3" /></audio></td>
</tr>
</table>
